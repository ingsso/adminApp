ğŸ‘· adminApp (ì¥ì• ë¬¼ ì‹ ê³  ê´€ë¦¬ì ì•±)

ë³¸ í”„ë¡œì íŠ¸ëŠ” ì‹¤ì‹œê°„ ì¥ì• ë¬¼ ê·¼ì ‘ ê²½ê³  ì•±)ê³¼ ì—°ë™ë˜ëŠ” ê´€ë¦¬ììš© ëª¨ë‹ˆí„°ë§ ì•±ì…ë‹ˆë‹¤.

ì§€ì—­(ê¸°ê´€) ê´€ë¦¬ìê°€ ë‹´ë‹¹ êµ¬ì—­ì„ ì„¤ì •í•˜ë©´, í•´ë‹¹ êµ¬ì—­ì˜ Geohashë¥¼ ê¸°ë°˜ìœ¼ë¡œ Firebaseì— ë“±ë¡ëœ ì¥ì• ë¬¼(CCTV) íƒì§€ ë‚´ì—­ì„ ì¹´ì¹´ì˜¤ë§µì—ì„œ ì‹œê°ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ê³ , ì‹¤ì‹œê°„ í‘¸ì‹œ ì•Œë¦¼(FCM)ì„ ìˆ˜ì‹ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ“± ì•± ì‹¤í–‰ ë°ëª¨ (GIF)


![output](https://github.com/user-attachments/assets/85240f83-8c69-4dd3-a3bd-959d7c4244c9)


![output (2)](https://github.com/user-attachments/assets/2ec34c00-8e27-483e-94cf-21035721c649)


ğŸ› ï¸ ì‚¬ìš©ëœ í•µì‹¬ ê¸°ìˆ 

-- ì–¸ì–´: Java


-- í”Œë«í¼: Android


-- ì§€ë„: Kakao Maps SDK


-- ë°ì´í„°ë² ì´ìŠ¤:
    - Firebase Realtime Database (ì¥ì• ë¬¼ ë°ì´í„°)
    - Cloud Firestore (ê´€ë¦¬ì FCM í† í°)

    
-- ìœ„ì¹˜: Google Play Services Location (FusedLocationProviderClient)



ğŸ—ºï¸ ì£¼ìš” ê¸°ëŠ¥

-- ì§€ì—­(ê¸°ê´€) ì„ íƒ
-> MainActivityì—ì„œ 3ë‹¨ê³„ ìŠ¤í”¼ë„ˆ(ì‹œ/ë„, ì‹œ/êµ¬/êµ°, ë™)ë¥¼ í†µí•´ ê´€ë¦¬ ë‹´ë‹¹ ì§€ì—­ì„ ì„ íƒí•©ë‹ˆë‹¤.
-> ì„ íƒëœ ê²½ë¡œëŠ” SharedPreferencesì— ì €ì¥ë˜ì–´ ì•± ì¬ì‹œì‘ ì‹œ ìœ ì§€ë©ë‹ˆë‹¤.


-- ì¥ì• ë¬¼ ë°ì´í„° ì—°ë™
-> ì„ íƒëœ ì§€ì—­ ê²½ë¡œ(organizations/...)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ Firebase Realtime DBì—ì„œ í•´ë‹¹ ì§€ì—­ì˜ geohash ê°’ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.


-- ì¹´ì¹´ì˜¤ë§µ ëª¨ë‹ˆí„°ë§
-> ë¶ˆëŸ¬ì˜¨ geohashë¥¼ ì´ìš©í•´ obstacles/{geohash} ê²½ë¡œì˜ ëª¨ë“  ì¥ì• ë¬¼ ë°ì´í„°ë¥¼ MapActivityì˜ ì¹´ì¹´ì˜¤ë§µ ìœ„ì— ë§ˆì»¤ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.


-- ì¥ì• ë¬¼ ìƒì„¸ ì •ë³´ í™•ì¸
-> ì§€ë„ ìœ„ì˜ ë§ˆì»¤(Label)ë¥¼ í´ë¦­í•˜ë©´, Base64ë¡œ ì¸ì½”ë”©ëœ ì¥ì• ë¬¼ ì´ë¯¸ì§€ë¥¼ ë””ì½”ë”©í•˜ì—¬ ë‹¤ì´ì–¼ë¡œê·¸ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.


-- ì‹¤ì‹œê°„ í‘¸ì‹œ ì•Œë¦¼ ìˆ˜ì‹ 
-> MyFirebaseMessageServiceë¥¼ í†µí•´ FCM í‘¸ì‹œ ì•Œë¦¼ì„ ìˆ˜ì‹ í•©ë‹ˆë‹¤.
-> ìƒˆë¡œìš´ ì¥ì• ë¬¼ ì‹ ê³ ê°€ ë°œìƒí–ˆì„ ë•Œ, ê´€ë¦¬ìì—ê²Œ ì¦‰ê°ì ì¸ ì•Œë¦¼(Heads-up Notification)ì„ ë³´ëƒ…ë‹ˆë‹¤.


-- ê´€ë¦¬ì í† í° ë“±ë¡ (íƒ€ê²Ÿ ì•Œë¦¼)
-> ê´€ë¦¬ìê°€ ì§€ì—­ì„ ì„¤ì •í•˜ë©´, í•´ë‹¹ ì§€ì—­ geohashë¥¼ ì´ë¦„ìœ¼ë¡œ í•˜ëŠ” Firestore Collectionì— ê´€ë¦¬ìì˜ FCM í† í°ê³¼ ê¸°ê¸° IDë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
-> ì´ë¥¼ í†µí•´ ì„œë²„ëŠ” íŠ¹ì • ì§€ì—­(geohash)ì— ì‹ ê³ ê°€ ë“¤ì–´ì™”ì„ ë•Œ, í•´ë‹¹ Firestore Collectionì— ë“±ë¡ëœ ê´€ë¦¬ìë“¤ì—ê²Œë§Œ ì •í™•í•˜ê²Œ í‘¸ì‹œ ì•Œë¦¼ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.


âš™ï¸ ì•„í‚¤í…ì²˜ ë° ë™ì‘ ì›ë¦¬

1. ì§€ì—­ ì„¤ì • (MainActivity)
-> ê´€ë¦¬ìê°€ ì•± ì‹¤í–‰ í›„ 'ê¸°ê´€ ì„¤ì •'ì—ì„œ "ì„œìš¸íŠ¹ë³„ì‹œ / ê°•ë‚¨êµ¬ / ì—­ì‚¼ë™"ì„ ì„ íƒí•©ë‹ˆë‹¤.
-> ì•±ì€ Firebase Realtime DBì˜ organizations/ì„œìš¸íŠ¹ë³„ì‹œ/ê°•ë‚¨êµ¬/ì—­ì‚¼ë™ì—ì„œ geohash ê°’ (ì˜ˆ: "9q9j6j")ì„ ì¡°íšŒí•©ë‹ˆë‹¤.


2. í† í° ë“±ë¡ (MainActivity)
-> ì¡°íšŒí•œ geohash ê°’("9q9j6j")ì„ ê¸°ë°˜ìœ¼ë¡œ Cloud Firestoreì˜ 9q9j6j ì»¬ë ‰ì…˜ì— ì´ ê´€ë¦¬ìì˜ ê¸°ê¸° IDì™€ FCM í† í°ì„ ì €ì¥í•©ë‹ˆë‹¤.
   (íƒ€ê²Ÿ í‘¸ì‹œ ì•Œë¦¼ì„ ìœ„í•¨, ì´ ì‘ì—…ì€ PREF_TOKEN_SAVED í”Œë˜ê·¸ë¥¼ í†µí•´ í•œ ë²ˆë§Œ ìˆ˜í–‰ë©ë‹ˆë‹¤.)


3. ì§€ë„ ì¡°íšŒ (btn_map_tap)
-> ê´€ë¦¬ìê°€ 'ì§€ë„ í™•ì¸' ë²„íŠ¼ì„ ëˆ„ë¦…ë‹ˆë‹¤.
-> ì•±ì€ geohash ê°’ì„ MapActivityë¡œ ì „ë‹¬í•˜ë©° ì•¡í‹°ë¹„í‹°ë¥¼ ì „í™˜í•©ë‹ˆë‹¤.


4. ëª¨ë‹ˆí„°ë§ (MapActivity)
-> MapActivityëŠ” ì „ë‹¬ë°›ì€ geohash (ì˜ˆ: "9q9j6j")ë¥¼ ì‚¬ìš©í•˜ì—¬ Realtime DBì˜ obstacles/9q9j6j ê²½ë¡œì— ìˆëŠ” ëª¨ë“  ì¥ì• ë¬¼ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
-> ë¶ˆëŸ¬ì˜¨ ë°ì´í„°(ìœ„ë„, ê²½ë„)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¹´ì¹´ì˜¤ë§µ ìœ„ì— ë§ˆì»¤ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
-> ë§ˆì»¤ í´ë¦­ ì‹œ, í•´ë‹¹ cctv_keyì˜ imageDataë¥¼ Base64 ë””ì½”ë”©í•˜ì—¬ ì´ë¯¸ì§€ ë‹¤ì´ì–¼ë¡œê·¸ë¥¼ ë„ì›ë‹ˆë‹¤.


5. ì‹¤ì‹œê°„ ì•Œë¦¼ (MyFirebaseMessageService)
-> (ì„œë²„ì—ì„œ) "9q9j6j" ì§€ì—­ì— ìƒˆ ì¥ì• ë¬¼ì´ ë“±ë¡ë˜ë©´, ì„œë²„ëŠ” Firestore 9q9j6j ì»¬ë ‰ì…˜ì˜ ëª¨ë“  í† í°ì„ ì¡°íšŒí•˜ì—¬ FCMì„ ë°œì†¡í•©ë‹ˆë‹¤.
-> ê´€ë¦¬ì ì•±ì€ FCMì„ ìˆ˜ì‹ í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ ì¦‰ì‹œ ì•Œë¦¼ì„ í‘œì‹œí•©ë‹ˆë‹¤.



ğŸ—„ï¸ Firebase ë°ì´í„° êµ¬ì¡°
ì´ ì•±ì€ Realtime Databaseì™€ Cloud Firestoreë¥¼ ëª¨ë‘ ì‚¬ìš©í•©ë‹ˆë‹¤.


1. Realtime Database (ì¥ì• ë¬¼ ë°ì´í„°)
  - organizations: ê¸°ê´€ë³„ geohash ì •ë³´ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
  - obstacles: geohashë³„ ì‹¤ì œ ì¥ì• ë¬¼(CCTV)ì˜ ìœ„ì¹˜ì™€ ì´ë¯¸ì§€ ë°ì´í„°ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.


```JSON
{
  "organizations": {
    "ì„œìš¸íŠ¹ë³„ì‹œ": {
      "ê°•ë‚¨êµ¬": {
        "ì—­ì‚¼ë™": {
          "geohash": "9q9j6j" 
        }
      }
    }
  },
  "obstacles": {
    "9q9j6j": {
      "cctv_key_001": {
        "latitude": 37.5665,
        "longitude": 126.9780,
        "imageData": "aW1hZ2VfZGF0YV9pbl9iYXNlNjQ="
      },
      "cctv_key_002": {
        "latitude": 37.5666,
        "longitude": 126.9781,
        "imageData": "YW5vdGhlcl9iYXNlNjRfZGF0YQ=="
      }
    }
  }
}
```


2. Cloud Firestore (ê´€ë¦¬ì FCM í† í°)
  - geohash ê°’ì„ ì»¬ë ‰ì…˜ IDë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
  - ê´€ë¦¬ìì˜ ê³ ìœ  ê¸°ê¸° IDë¥¼ ë¬¸ì„œ IDë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
  - í•´ë‹¹ ê¸°ê¸°ì˜ FCM í† í°ì„ ì €ì¥í•˜ì—¬ íƒ€ê²Ÿ ì•Œë¦¼ ë°œì†¡ì— ì‚¬ìš©í•©ë‹ˆë‹¤.

```Bash
(Collection) 9q9j6j
  â”” (Document) admin_device_id_001
      â”” (Field) token: "fcm_token_for_device_001..."
  â”” (Document) admin_device_id_002
      â”” (Field) token: "fcm_token_for_device_002..."
```
